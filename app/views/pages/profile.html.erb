<div class="text-center">
  <h1>Profile Page</h1>
</div>

<div class="container">
  <div class="row">
    <div class="col-12 col-md-4">
      <p><%= image_tag "https://image.flaticon.com/icons/svg/2919/2919573.svg", class: "avatar" %></p>
      <p><%= current_user.nickname %></p>
      <p><%= current_user.description %></p>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class=border>
    <% cash=100000 %>
    <% equity=0 %>
    <% @positions.each do | position | %>
      <% equity += position.total_amount %>
    <% end %>
    <p>Cash: <%=cash %></p>
    <p>Equity: <%= equity %></p>
  </div>

  <table style = "width:100%" class="table table-hover table-striped">
    <thead>
      <tr class="border">
        <th class= "table-text-color" scope="col">Symbol</th>
        <th class= "table-text-color" scope="col">Date</th>
        <th class= "table-text-color" scope="col">Time</th>
        <th class= "table-text-color" scope="col">Buy/Sell</th>
        <th class= "table-text-color" scope="col">Size</th>
        <th class= "table-text-color" scope="col">Entry</th>
        <th class= "table-text-color" scope="col">$</th>
        <th class= "table-text-color" scope="col">Bline</th>
        <th class= "table-text-color" scope="col">Target</th>
        <th class= "table-text-color" scope="col">Stop Loss</th>
        <th class= "table-text-color" scope="col">Stock Price</th>
        <th class= "table-text-color" scope="col">P/L%</th>
        <th class= "table-text-color" scope="col">1R</th>
        <th class= "table-text-color" scope="col">2R</th>
        <th class= "table-text-color" scope="col">3R</th>
        <th class= "table-text-color" scope="col">Shares</th>
        <th class= "table-text-color" scope="col">P/L</th>
        <th class= "table-text-color" scope="col">Wallet %</th>
      </tr>
    <thead>
      <tbody>
        <% @positions.each do | position | %>
        <tr class="border">
          <th class= "table-text-color" scope="row"><%= Stock.pluck[position.stock_id - 1][1]%></th>
          <th class= "table-text-color" scope="row"><%=position.created_at.to_date %></th>
          <th class= "table-text-color" scope="row"><%=position.created_at.to_time.to_s.split[1] %></th>
          <th class= "table-text-color" scope="row"><%=position.buy_sell%></th>
          <th class= "table-text-color" scope="row"><%=position.size%></th>
          <th class= "table-text-color" scope="row"><%= position.entry%></th>
          <th class= "table-text-color" scope="row"><%= number_to_currency(position.total_amount) %></th>
          <th class= "table-text-color" scope="row"><%= position.baseline %></th>
          <th class= "table-text-color" scope="row"><%= position.target %></th>
          <th class= "table-text-color" scope="row"><%= position.stop_loss %></th>
          <th class= "table-text-color" scope="row"><%= position.current_price %></th>
          <th class= "table-text-color" scope="row"><%= position.gain_loss_percentage.truncate(4)*100 %></th>
          <th class= "table-text-color" scope="row"><%= position.r1 %></th>
          <th class= "table-text-color" scope="row"><%= position.r2 %></th>
          <th class= "table-text-color" scope="row"><%= position.r3 %></th>
          <th class= "table-text-color" scope="row"><%# position.quantity_1 - (position.quantity_1 - x) %></th>
          <th class= "table-text-color" scope="row"></th>
          <th class= "table-text-color" scope="row"></th>
        </tr>
        <% end %>

      </tbody>


          </table>
</div>


<div class="container text-center">
  <!-- TradingView Widget BEGIN -->
  <div class="tradingview-widget-container">
    <div id="tradingview_ffdae"></div>
    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/symbols/AMEX-SPY/" rel="noopener" target="_blank"><span class="blue-text">SPY Chart</span></a> by TradingView</div>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
    new TradingView.widget(
    {
    "width": 980,
    "height": 610,
    "symbol": "AMEX:SPY",
    "interval": "D",
    "timezone": "Etc/UTC",
    "theme": "dark",
    "style": "2",
    "locale": "en",
    "toolbar_bg": "#f1f3f6",
    "enable_publishing": false,
    "hide_side_toolbar": false,
    "allow_symbol_change": true,
    "container_id": "tradingview_ffdae"
  }
    );
    </script>
  </div>
  <!-- TradingView Widget END -->
</div>

<div class="container text-center">
    <!-- TradingView Widget BEGIN -->
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/screener/" rel="noopener" target="_blank"><span class="blue-text">Stock Screener</span></a> by TradingView</div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
    {
    "width": 1100,
    "height": 512,
    "defaultColumn": "overview",
    "defaultScreen": "most_capitalized",
    "market": "america",
    "showToolbar": true,
    "colorTheme": "dark",
    "locale": "en"
  }
    </script>
  </div>
  <!-- TradingView Widget END -->
</div>
